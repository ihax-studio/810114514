<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>5x5 ã‚ªã‚»ãƒ­</title>
  <link rel="stylesheet" href="osero.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
    <div id="introImage"></div><!--æœ€åˆã®ç”»åƒ-->
<h2 id="status">ç™½ã®ã‚¿ãƒ¼ãƒ³ã ã‚¾ğŸ˜</h2>
<table id="board"></table>

<img id="winnerImage" src="" width="200">

<button id="retryButton">ã‚„ã‚Šç›´ã™</button>

<div id="oseroView"></div>

<audio id="errorSound" src="mac.wav"></audio>
<audio id="placeSound" src="wrong.mp3"></audio>

<!-- !ãƒœã‚¿ãƒ³ â†’ ã‚„ã‚Šç›´ã™ ã¸ã®ãƒœã‚¿ãƒ³ -->
<div id="retryShowBtn" class="floating-retry-btn">
  <div class="retry-btn-inner">!</div>
</div>
<script>
let retryBtnTimer = null;
const retryShowBtn = document.getElementById('retryShowBtn');
const retryInner = retryShowBtn.querySelector('.retry-btn-inner');

// åˆæœŸ0.5ç§’å¾Œã« ! ã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
window.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    retryShowBtn.classList.add('show');
  }, 500);
});
// ! ã‚’æŠ¼ã—ãŸã‚‰ â†’ ã‚„ã‚Šç›´ã™è¡¨ç¤º
retryShowBtn.onclick = () => {
  // ã™ã§ã«wideãªã‚‰ç„¡è¦–
  if (retryShowBtn.classList.contains('wide')) return;

  retryShowBtn.classList.add('wide');
  retryInner.textContent = 'ã‚„ã‚Šç›´ã™';
  retryInner.classList.add('fade-in');

  // ä¸€åº¦æŠ¼ã•ã‚ŒãŸã‚‰ã‚ºãƒ¼ãƒ ã‚¢ãƒ‹ãƒ¡ã¸
  retryShowBtn.onclick = () => {
    // âœ… 0.5ç§’ã§scale+blurã‚¢ãƒ‹ãƒ¡ï¼ˆJSã§ç¢ºå®Ÿã«ï¼‰
    document.body.style.transform = 'scale(1.5)';
    document.body.style.filter = 'blur(10px)';

    // âœ… é·ç§»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚‚ç¢ºå®Ÿã«åŒæœŸ
    setTimeout(() => {
      window.location.href = '810.html';
    }, 550);
  };

  // 1.7ç§’å¾Œã«ã€Œ!ã€ã¸æˆ»ã™
  if (retryBtnTimer) clearTimeout(retryBtnTimer);
  retryBtnTimer = setTimeout(() => {
    retryShowBtn.classList.remove('wide');
    retryInner.classList.remove('fade-in');
    retryInner.textContent = '!';
    retryShowBtn.onclick = originalClick;
  }, 1700);
};

// originalClické–¢æ•°ã‚‚åŒæ§˜ã«JSåˆ¶å¾¡
const originalClick = () => {
  retryShowBtn.classList.add('wide');
  retryInner.textContent = 'ã‚„ã‚Šç›´ã™';
  retryInner.classList.add('fade-in');

  retryShowBtn.onclick = () => {
    document.body.style.transform = 'scale(1.5)';
    document.body.style.filter = 'blur(10px)';

    setTimeout(() => {
      window.location.href = '810.html';
    }, 650);
  };

  if (retryBtnTimer) clearTimeout(retryBtnTimer);
  retryBtnTimer = setTimeout(() => {
    retryShowBtn.classList.remove('wide');
    retryInner.classList.remove('fade-in');
    retryInner.textContent = '!';
    retryShowBtn.onclick = originalClick;
  }, 1700);
};

</script>


<script>
  const SIZE = 5;
  const EMPTY = '';
  const WHITE = 'b1.png';
  const BLACK = 'b8.png';

  let currentPlayer = WHITE;
  let isProcessing = false;

  const board = Array.from({ length: SIZE }, () => Array(SIZE).fill(EMPTY));
  const boardElement = document.getElementById('board');
  const statusText = document.getElementById('status');
  const errorSound = document.getElementById('errorSound');
  const placeSound = document.getElementById('placeSound');
  const winnerImage = document.getElementById('winnerImage');
  const retryButton = document.getElementById('retryButton');
  const oseroView = document.getElementById('oseroView');

  const directions = [
    [-1, 0], [1, 0], [0, -1], [0, 1],
    [-1, -1], [1, 1], [-1, 1], [1, -1]
  ];

  const mid = Math.floor(SIZE / 2);
  board[mid][mid] = WHITE;
  board[mid - 1][mid - 1] = WHITE;
  board[mid - 1][mid] = BLACK;
  board[mid][mid - 1] = BLACK;

  function drawBoard() {
    boardElement.innerHTML = '';
    let validMovesExist = false;

    for (let i = 0; i < SIZE; i++) {
      const row = document.createElement('tr');
      for (let j = 0; j < SIZE; j++) {
        const cell = document.createElement('td');
        cell.dataset.row = i;
        cell.dataset.col = j;

        if (isValidMove(i, j, currentPlayer)) {
          cell.classList.add('valid');
          validMovesExist = true;
        }

        const piece = board[i][j];
        if (piece) {
  const wrapper = document.createElement('div');
  wrapper.className = 'piece-wrapper';

  const img = document.createElement('img');
  img.src = piece;
  img.className = 'piece';

  // ã‚¿ãƒ¼ãƒ³ã«å¿œã˜ã¦å›è»¢ï¼ˆXè»¸ã¾ãŸã¯Yè»¸ï¼‰
  const rotation = currentPlayer === WHITE ? 'rotateY(0deg)' : 'rotateY(180deg)';
  img.style.transform = rotation;

  wrapper.appendChild(img);
  cell.appendChild(wrapper);
}



        cell.addEventListener('click', handleClick);
        row.appendChild(cell);
      }
      boardElement.appendChild(row);
    }


    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼†åè»¢
    statusText.textContent = currentPlayer === WHITE ? "MURã®ã‚¿ãƒ¼ãƒ³ã ã‚¾ğŸ˜" : "ç”°æ‰€ã®ã‚¿ãƒ¼ãƒ³ã ã‚¾ğŸ˜°";
    statusText.style.transform = currentPlayer === BLACK ? "rotate(180deg)" : "rotate(0deg)";

  // 3Dé¢¨å›è»¢ã¨å¥¥è¡Œãå¤‰åŒ–
  const angle = currentPlayer === WHITE ? 15 : -15;
  const depth = currentPlayer === WHITE ? 'scale(1.05)' : 'scale(0.95)';
  boardElement.style.transform = `perspective(900px) rotateX(${angle}deg) ${depth}`;

    if (!validMovesExist && !isProcessing) {
      showWinner();
    }
  }

  function isValidMove(x, y, player) {
    if (board[x][y] !== EMPTY) return false;
    const opponent = player === WHITE ? BLACK : WHITE;

    for (const [dx, dy] of directions) {
      let nx = x + dx, ny = y + dy, hasOpponent = false;
      while (nx >= 0 && ny >= 0 && nx < SIZE && ny < SIZE) {
        if (board[nx][ny] === opponent) {
          hasOpponent = true;
        } else if (board[nx][ny] === player && hasOpponent) {
          return true;
        } else {
          break;
        }
        nx += dx; ny += dy;
      }
    }
    return false;
  }

  function handleClick(e) {
    if (isProcessing) return;

    const cell = e.currentTarget;
    const row = parseInt(cell.dataset.row);
    const col = parseInt(cell.dataset.col);

    if (!isValidMove(row, col, currentPlayer)) {
      errorSound.currentTime = 0;
      errorSound.play();
      cell.classList.add('shake');
      setTimeout(() => cell.classList.remove('shake'), 550);
      return;
    }

    // å³åº§ã«ç½®ã
    board[row][col] = currentPlayer;
    drawBoard();

    placeSound.currentTime = 0;
    placeSound.play();

    isProcessing = true;
// ã‚«ãƒ¼ãƒ†ãƒ³æ¶ˆå»ã¯ 0.05ç§’å¾Œã«é–‹å§‹ï¼ˆå¤‰æ›´ä¸è¦ï¼‰
setTimeout(() => {
  curtain.classList.add('hide'); // â† hideè¿½åŠ ã§1ç§’ã‹ã‘ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ãƒƒãƒ—
}, 50);

    setTimeout(() => {
      flipPieces(row, col, currentPlayer);
      currentPlayer = currentPlayer === WHITE ? BLACK : WHITE;
      isProcessing = false;
      drawBoard();
    }, 220);
  }

  function flipPieces(x, y, player) {
    const opponent = player === WHITE ? BLACK : WHITE;

    for (const [dx, dy] of directions) {
      let nx = x + dx, ny = y + dy;
      const toFlip = [];

      while (nx >= 0 && ny >= 0 && nx < SIZE && ny < SIZE) {
        if (board[nx][ny] === opponent) {
          toFlip.push([nx, ny]);
        } else if (board[nx][ny] === player) {
          for (const [fx, fy] of toFlip) {
            board[fx][fy] = player;
          }
          break;
        } else {
          break;
        }
        nx += dx; ny += dy;
      }
    }
  }

  function showWinner() {
    let whiteCount = 0, blackCount = 0;
    for (let row of board) {
      for (let cell of row) {
        if (cell === WHITE) whiteCount++;
        if (cell === BLACK) blackCount++;
      }
    }

    const winner = whiteCount > blackCount ? 'white' : 'black';
    winnerImage.src = `${winner}.png`;
    winnerImage.style.animation = 'slideUp 0.7s cubic-bezier(.77,0,.18,1);';

    retryButton.style.display = 'inline-block';
    setTimeout(() => retryButton.style.opacity = 1, 100);
  }

  retryButton.addEventListener('click', () => {
    oseroView.style.top = '0'; // ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ€ã‚¦ãƒ³
    setTimeout(() => {
      // osero.htmlã¸å®Ÿéš›ã«é·ç§»ï¼ˆå¿…è¦ãªã‚‰ï¼‰
      window.location.href = 'osero.html';
    }, 1100);
  });

  drawBoard();
</script><audio id="bgm" src="bg.mp3" loop></audio>
<div id="blackCurtain"></div>
<audio id="bgm" src="bg.mp3" loop></audio>

<script>window.addEventListener('DOMContentLoaded', () => {
  const curtain = document.getElementById('blackCurtain');

  // âœ… ã‚«ãƒ¼ãƒ†ãƒ³ã‚’1ç§’ã‹ã‘ã¦ä¸Šã«ã‚¹ãƒ©ã‚¤ãƒ‰ã•ã›ã¦æ¶ˆã™
  setTimeout(() => {
    curtain.classList.add('hide');
  }, 150); // ã¡ã‚‡ã£ã¨é…ã‚‰ã›ã¦è‡ªç„¶ã«

  // âœ… èƒŒæ™¯ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å°‘ã—é…ã‚‰ã›ã¦å®Ÿè¡Œï¼ˆoptionalï¼‰
  setTimeout(() => {
    document.body.style.transition = '0.4s cubic-bezier(.77,0,.18,1)';
    document.body.style.transform = 'scale(1.1)';
  }, 400); // curtainã®å¾Œã«å‹•ã‹ã™ã“ã¨ã§è‡ªç„¶

  // âœ… boardè¡¨ç¤ºã®ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆä¾‹ï¼šscale(0.8â†’1)ï¼‰
  setTimeout(() => {
    const board = document.getElementById('board');
    board.style.transition = '0.7s cubic-bezier(.77,0,.18,1)';
    board.style.transform = 'scale(1)';
  }, 1000);


  // 4. BGMå†ç”Ÿ
  const bgm = document.getElementById('bgm');
  if (bgm) {
    bgm.volume = 0.5;
    bgm.play().catch(e => console.warn('BGMå†ç”Ÿå¤±æ•—:', e));
  }
});

</script>



</body></html>
